<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Instant Game SDK Test</title>
    <style>
        html {
            width: 100%;
            overflow-x: hidden;
            /* é˜²æ­¢æ°´å¹³æ»šåŠ¨ */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f5f7fa;
            padding-top: 400px;
            /* ä¸ºå›ºå®šçš„è¾“å‡ºåŒºåŸŸé¢„ç•™ç©ºé—´ */
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            html {
                overflow-x: hidden;
            }

            body {
                margin: 0 !important;
                padding: 0 !important;
                padding-top: 320px !important;
                max-width: none !important;
                width: 100% !important;
                background-color: #f5f7fa;
            }
            
            .section {
                margin: 8px 8px !important;
                padding: 12px !important;
                border-radius: 6px;
                box-sizing: border-box;
            }
            
            input, select {
                width: 100% !important;
                max-width: none !important;
                margin: 8px 0 !important;
                font-size: 16px !important;
                box-sizing: border-box;
                padding: 12px;
            }
            
            button {
                font-size: 16px !important;
                padding: 12px 20px !important;
                margin: 8px 8px 8px 0 !important;
                min-height: 44px;
                width: auto;
                box-sizing: border-box;
            }
            
            .section h2 {
                font-size: 18px !important;
                margin: 0 0 10px 0 !important;
            }
            
            .section h3 {
                font-size: 16px !important;
                margin: 10px 0 8px 0 !important;
            }
            
            .section p {
                font-size: 14px !important;
                line-height: 1.5 !important;
                margin: 8px 0 !important;
            }
            
            h1 {
                font-size: 18px !important;
                margin: 8px 8px 16px 8px !important;
                color: #2c3e50;
                text-align: left;
            }
        }
        
        /* å¹³æ¿ç«¯é€‚é… */
        @media (min-width: 769px) and (max-width: 1024px) {
            body {
                max-width: 900px;
                padding: 0 15px;
            }
            
            input, select {
                width: 250px;
            }
            
            #output {
                width: calc(100% - 60px);
                max-width: 860px;
            }
            
            .output-header {
                width: calc(100% - 60px);
                max-width: 860px;
            }
        }

        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #34495e;
            margin: 15px 0 10px 0;
        }

        .section p {
            color: #7f8c8d;
            margin: 10px 0;
            line-height: 1.4;
        }

        button {
            margin: 5px;
            padding: 10px 16px;
            cursor: pointer;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #2980b9;
        }

        input,
        select {
            margin: 5px;
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
            box-sizing: border-box;
        }
        
        /* ç¡®ä¿åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šçš„åŸºæœ¬å“åº”å¼ */
        @media (max-width: 480px) {
            input, select {
                width: calc(100% - 10px) !important;
                margin: 5px 0;
            }
        }

        .params-info {
            background: #ecf0f1;
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
            color: #7f8c8d;
        }

        #output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 0 0 4px 4px;
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            border: 2px solid #34495e;
            border-top: none;
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 80px);
            max-width: 1160px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* ç§»åŠ¨ç«¯è¾“å‡ºåŒºåŸŸé€‚é… */
        @media (max-width: 768px) {
            #output {
                left: 8px !important;
                right: 8px !important;
                width: auto !important;
                transform: none !important;
                padding: 10px !important;
                font-size: 11px !important;
                height: 200px !important;
                top: 45px !important;
                max-width: none !important;
                box-sizing: border-box;
            }
        }

        .output-header {
            background: #34495e;
            color: #ecf0f1;
            padding: 8px 15px;
            border-radius: 4px 4px 0 0;
            margin: 0;
            font-weight: bold;
            font-size: 14px;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 80px);
            max-width: 1160px;
            z-index: 1001;
            border: 2px solid #34495e;
            border-bottom: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* ç§»åŠ¨ç«¯æ ‡é¢˜æ é€‚é… */
        @media (max-width: 768px) {
            .output-header {
                left: 8px !important;
                right: 8px !important;
                width: auto !important;
                transform: none !important;
                padding: 8px 12px !important;
                font-size: 13px !important;
                top: 10px !important;
                max-width: none !important;
                box-sizing: border-box;
            }
        }

        .clear-btn {
            float: right;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .clear-btn:hover {
            background: #c0392b;
        }
        /* Avatar æ˜¾ç¤º */
        .avatar-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }
    </style>
</head>

<body>
    <h1>ZK Game SDK å®Œæ•´æ¥å£æµ‹è¯•é¡µé¢</h1>

    <div class="avatar-wrapper">
        <img class="avatar" src="http://astroby-lucky.oss-accelerate.aliyuncs.com/images/favicon.jpeg" alt="å¤´åƒ">
    </div>
    <div class="output-header">
        ğŸ“‹ è¾“å‡ºæ—¥å¿— (å®æ—¶æ˜¾ç¤º)
        <button class="clear-btn" onclick="clearLog()">æ¸…ç©º</button>
    </div>
    <div id="output"></div>

    <div class="section">
        <h2>ğŸ“± SDK åˆå§‹åŒ–</h2>
        <p><strong>è¯´æ˜ï¼š</strong>åˆå§‹åŒ–SDKï¼Œå¿…é¡»åœ¨ä½¿ç”¨å…¶ä»–åŠŸèƒ½å‰è°ƒç”¨</p>
        <button onclick="initSDK()">Initialize SDK</button>
        <div class="params-info">
            <small>é…ç½®å‚æ•°: APP_ID='10040', SECRET_KEY='phc_Js87w93pRKVMN3AI4N1ITa8PaeNdeASpHg6fTaaWYzE'</small>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ‘¤ ç”¨æˆ·æ“ä½œ</h2>
        <p><strong>è¯´æ˜ï¼š</strong>ç”¨æˆ·ç™»å½•å’Œåˆ†äº«åŠŸèƒ½ï¼Œç™»å½•åå¯è·å–ç”¨æˆ·ä¿¡æ¯</p>
        <button onclick="login()">Login ç”¨æˆ·ç™»å½•</button>
        <button onclick="share()">Share åˆ†äº«</button>
        <button onclick="inviteFriend()">é‚€è¯·å¥½å‹</button>
        <button onclick="createShortcut()">Create Shortcut åˆ›å»ºå¿«æ·å›¾æ ‡</button>
    </div>

    <div class="section">
        <h2>ğŸ’¾ æ•°æ®å­˜å‚¨</h2>
        <p><strong>è¯´æ˜ï¼š</strong>æœ¬åœ°æ•°æ®å­˜å‚¨å’Œè¯»å–ï¼Œå¯ç”¨äºä¿å­˜æ¸¸æˆè¿›åº¦</p>
        <input type="text" id="save_key" placeholder="å­˜å‚¨Key">
        <input type="text" id="save_value" placeholder="å­˜å‚¨Value">
        <button onclick="saveData()">Save Data ä¿å­˜æ•°æ®</button>
        <br><br>
        <input type="text" id="load_keys" placeholder="è¯»å–Keys (é€—å·åˆ†éš”)">
        <button onclick="loadData()">Load Data è¯»å–æ•°æ®</button>
    </div>

    <div class="section">
        <h2>ğŸ“º å¹¿å‘ŠåŠŸèƒ½</h2>
        <p><strong>è¯´æ˜ï¼š</strong>æ”¯æŒä¸‰ç§å¹¿å‘Šç±»å‹ï¼šBanneræ¨ªå¹…å¹¿å‘Šã€æ¿€åŠ±è§†é¢‘å¹¿å‘Šã€æ’å±å¹¿å‘Š</p>

        <h3>Banner æ¨ªå¹…å¹¿å‘Š</h3>
        <input type="text" id="banner_id" placeholder="Bannerå¹¿å‘ŠID (å¦‚: 123456)">
        <select id="banner_position">
            <option value="top">Top é¡¶éƒ¨</option>
            <option value="bottom" selected>Bottom åº•éƒ¨</option>
        </select>
        <button onclick="showAd('banner')">Show Banner Ad æ˜¾ç¤ºBanner</button>
        <button onclick="hideBannerAd()">Hide Banner Ad éšè—Banner</button>

        <h3>æ¿€åŠ±è§†é¢‘å¹¿å‘Š</h3>
        <input type="text" id="rewarded_id" placeholder="æ¿€åŠ±å¹¿å‘ŠID (å¦‚: 789012)">
        <button onclick="showAd('rewarded')">Show Rewarded Ad æ˜¾ç¤ºæ¿€åŠ±å¹¿å‘Š</button>
        <button onclick="loadShowRewardedAd()">Load&Show Rewarded åŠ è½½å¹¶æ˜¾ç¤º</button>

        <h3>æ’å±å¹¿å‘Š</h3>
        <input type="text" id="interstitial_id" placeholder="æ’å±å¹¿å‘ŠID (å¦‚: 345678)">
        <button onclick="showAd('interstitial')">Show Interstitial Ad æ˜¾ç¤ºæ’å±</button>
        <button onclick="loadShowInterstitialAd()">Load&Show Interstitial åŠ è½½å¹¶æ˜¾ç¤º</button>
    </div>

    <div class="section">
        <h2>ğŸ’° æ”¯ä»˜åŠŸèƒ½</h2>
        <p><strong>è¯´æ˜ï¼š</strong>åº”ç”¨å†…è´­ä¹°ï¼Œæ”¯æŒå¤šç§è´§å¸ï¼Œè‡ªåŠ¨ç”Ÿæˆè®¢å•ID</p>
        <input type="text" id="pd_price" placeholder="ä»·æ ¼ (å¦‚: 9.99)">
        <input type="text" id="pd_name" placeholder="å•†å“åç§° (å¦‚: é‡‘å¸åŒ…)">
        <input type="text" id="pd_des" placeholder="å•†å“ä»‹ç» (å¦‚: 1000é‡‘å¸ç¤¼åŒ…)">
        <select id="currency">
            <option value="USD" selected>USD ç¾å…ƒ</option>
            <option value="EUR">EUR æ¬§å…ƒ</option>
            <option value="CNY">CNY äººæ°‘å¸</option>
        </select>
        <button onclick="doPay()">Purchase å‘èµ·æ”¯ä»˜</button>
    </div>

    <div class="section">
        <h2>ğŸ® æ¸¸æˆç®¡ç†</h2>
        <p><strong>è¯´æ˜ï¼š</strong>æ¸¸æˆåˆ‡æ¢ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œä¼šè¯æ•°æ®</p>
        <input type="text" id="switch_app_id" placeholder="åˆ‡æ¢åˆ°çš„æ¸¸æˆID">
        <input type="text" id="switch_params" placeholder="åˆ‡æ¢å‚æ•° (JSONæ ¼å¼)">
        <button onclick="switchGame()">Switch Game åˆ‡æ¢æ¸¸æˆ</button>
        <br><br>
        <input type="text" id="session_data" placeholder="ä¼šè¯æ•°æ® (JSONæ ¼å¼)">
        <button onclick="setSessionData()">Set Session Data è®¾ç½®ä¼šè¯æ•°æ®</button>
        <br><br>
        <button onclick="setupPauseListener()">Setup Pause Listener è®¾ç½®æš‚åœç›‘å¬</button>
        <button onclick="quitGame()">Quit Game é€€å‡ºæ¸¸æˆ</button>
    </div>

    <div class="section">
        <h2>ğŸ“ˆ è‡ªå®šä¹‰äº‹ä»¶è¿½è¸ª</h2>
        <p><strong>è¯´æ˜ï¼š</strong>ç”¨äºæ•°æ®åˆ†æå’Œç”¨æˆ·è¡Œä¸ºè¿½è¸ªçš„è‡ªå®šä¹‰äº‹ä»¶</p>
        <input type="text" id="eventName" placeholder="äº‹ä»¶åç§° (å¦‚: level_complete)">
        <input type="text" id="eventId" placeholder="äº‹ä»¶ID (å¦‚: level_1)">
        <input type="text" id="eventValue" placeholder="äº‹ä»¶å€¼ (å¦‚: 100)">
        <input type="text" id="eventPayload" placeholder="äº‹ä»¶æ•°æ® (JSONæ ¼å¼)">
        <button onclick="trackEvent()">Track Event è¿½è¸ªäº‹ä»¶</button>
    </div>

    <div class="section">
        <h2>ğŸ”§ SDK ä¿¡æ¯</h2>
        <p><strong>è¯´æ˜ï¼š</strong>æ˜¾ç¤ºå½“å‰SDKçš„è¿è¡ŒçŠ¶æ€å’Œå¹³å°ä¿¡æ¯</p>
        <button onclick="showSDKInfo()">Show SDK Info æ˜¾ç¤ºSDKä¿¡æ¯</button>
        <button onclick="clearLog()">Clear Log æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <template id="leaderboardTemplate">
        <style>
            .leaderboard-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
            }

            .leaderboard-table th,
            .leaderboard-table td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }

            .leaderboard-table th {
                background-color: #f5f5f5;
            }
        </style>
    </template>

    <script src="./src/js/zkgame-sdk-v1.0.min.js"></script>
    <script src="https://connect.facebook.net/en_US/fbinstant.8.0.js"></script>

    <script>
        let gameSDK;

        function log(message) {
            const output = document.getElementById('output');
            output.textContent = new Date().toISOString() + ': ' + message + '\n' + output.textContent;
        }

        async function initSDK() {
            try {
                const cfg = {
                    APP_ID: '10040',
                    SECRET_KEY: 'phc_Js87w93pRKVMN3AI4N1ITa8PaeNdeASpHg6fTaaWYzE',
                    PLATFORM: 'facebook',
                    TEST_MODE: true,
                }
                gameSDK = new window.GameSDK(cfg);
                // gameSDK = window.zkgameSDK; //é»˜è®¤
                await gameSDK.init();
                log('SDK initialized successfully');
                await getLaunchParams();
            } catch (error) {
                log('Error initializing SDK: ' + error.message);
            }
        }

        async function login() {
            try {
                const result = await gameSDK.login();
                log('Login success: ' + JSON.stringify(result));
            } catch (error) {
                log('Login error: ' + error.message);
            }
        }

        async function share() {
            try {
                const shareImage = "";//å›¾ç‰‡çš„ Base64 æ•°æ®;
                await gameSDK.share({
                    title: 'Test Share',
                    image: shareImage,
                    data: { test: 'data' }
                });
                log('Share success');
            } catch (error) {
                log('Share error: ' + error.message);
            }
        }

        //é‚€è¯·å¥½å‹
        async function inviteFriend() {
            try {
                const shareImage = "";//å›¾ç‰‡çš„ Base64 æ•°æ®;
                await gameSDK.inviteAsync({
                    title: 'Invite Friend',
                    image: shareImage,
                    data: { invite: 'friend' }
                });
                log('Invite success');
            } catch (error) {
                log('Invite error: ' + error.message);
            }
        }

        //è·å–æ¸¸æˆå¯åŠ¨åæºå¸¦çš„å‚æ•°
        async function getLaunchParams() {
            try {
                const params = await gameSDK.getEntryPointData();
                log('Launch Params: ' + JSON.stringify(params));
            } catch (error) {
                log('Get launch params error: ' + error.message);
            }
        }

        async function showAd(type) {
            try {
                if (type === "banner") {
                    const banner_id = document.getElementById('banner_id').value;
                    const position = document.getElementById('banner_position').value;
                    await gameSDK.showBannerAd(banner_id, position);
                } else if (type === "rewarded") {
                    const rewarded_id = document.getElementById('rewarded_id').value;
                    let rewardedVideoAd = await gameSDK.loadRewardedVideoAd(rewarded_id);
                    //å¯åŠ¨æ¸¸æˆçš„æ—¶å€™å¯ä»¥é€‚å½“ç¼“å­˜ä¸€äº›rewardedVideoAdï¼Œä¾¿äºåŠæ—¶çš„å±•ç¤ºå¹¿å‘Š
                    const result = await gameSDK.showRewardedVideoAd(rewardedVideoAd);
                    log('Rewarded Ad Result: ' + JSON.stringify(result));
                } else if (type === "interstitial") {
                    const interstitial_id = document.getElementById('interstitial_id').value;
                    let interstitialAd = await gameSDK.loadInterstitialAd(interstitial_id);
                    const result = await gameSDK.showInterstitialAd(interstitialAd);
                    log('Interstitial Ad Result: ' + JSON.stringify(result));
                }
                log('Ad shown successfully: ' + type);
            } catch (error) {
                log('Ad error: ' + error.message);
            }
        }

        async function hideBannerAd() {
            try {
                await gameSDK.hideBannerAd();
                log('Banner ad hidden');
            } catch (error) {
                log('Hide banner error: ' + error.message);
            }
        }

        async function loadShowRewardedAd() {
            try {
                const rewarded_id = document.getElementById('rewarded_id').value;
                const result = await gameSDK.loadShowRewardedVideoAd(rewarded_id);
                log('Load&Show Rewarded Result: ' + JSON.stringify(result));
            } catch (error) {
                log('Load&Show rewarded error: ' + error.message);
            }
        }

        async function loadShowInterstitialAd() {
            try {
                const interstitial_id = document.getElementById('interstitial_id').value;
                const result = await gameSDK.loadShowInterstitialAd(interstitial_id);
                log('Load&Show Interstitial Result: ' + JSON.stringify(result));
            } catch (error) {
                log('Load&Show interstitial error: ' + error.message);
            }
        }

        async function doPay() {
            try {
                const price = document.getElementById('pd_price').value;
                const name = document.getElementById('pd_name').value;
                const des = document.getElementById('pd_des').value;
                const currency = document.getElementById('currency').value;
                const orderId = "20251222" + Math.floor(Date.now() / 1000);
                const order = {
                    orderId: orderId,
                    amount: price,
                    country: "US",
                    currency: currency,
                    prodName: name,
                    description: des,
                    extra: orderId + "_" + price + "_" + name,
                    callbackUrl: "https://api.zencodegames.com/payment/callback"
                }
                const result = await gameSDK.toPay(order);
                log('Purchase result: ' + JSON.stringify(result));
            } catch (error) {
                log('Purchase error: ' + error.message);
            }
        }

        async function trackEvent() {
            try {
                const name = document.getElementById('eventName').value;
                const eventId = document.getElementById('eventId').value || "";
                const eventValue = document.getElementById('eventValue').value || "0";
                const payload = JSON.parse(document.getElementById('eventPayload').value || '{}');
                gameSDK.trackEvent(name, eventId, eventValue, payload);
                log('Event tracked: ' + name + ' (ID: ' + eventId + ', Value: ' + eventValue + ')');
            } catch (error) {
                log('Track event error: ' + error.message);
            }
        }

        // æ•°æ®å­˜å‚¨åŠŸèƒ½
        async function saveData() {
            try {
                const key = document.getElementById('save_key').value;
                const value = document.getElementById('save_value').value;
                const data = {};
                data[key] = value;
                await gameSDK.saveData(data);
                log('Data saved: ' + key + ' = ' + value);
            } catch (error) {
                log('Save data error: ' + error.message);
            }
        }

        async function loadData() {
            try {
                const keysStr = document.getElementById('load_keys').value;
                const keys = keysStr.split(',').map(k => k.trim());
                const data = await gameSDK.loadData(keys);
                log('Data loaded: ' + JSON.stringify(data));
            } catch (error) {
                log('Load data error: ' + error.message);
            }
        }


        // æ¸¸æˆç®¡ç†åŠŸèƒ½
        async function switchGame() {
            try {
                const appId = document.getElementById('switch_app_id').value;
                const paramsStr = document.getElementById('switch_params').value;
                const params = paramsStr ? JSON.parse(paramsStr) : undefined;
                const result = await gameSDK.switchGame(appId, params);
                log('Switch game result: ' + JSON.stringify(result));
            } catch (error) {
                log('Switch game error: ' + error.message);
            }
        }

        async function setSessionData() {
            try {
                const dataStr = document.getElementById('session_data').value;
                const data = JSON.parse(dataStr);
                await gameSDK.setSessionData(data);
                log('Session data set: ' + dataStr);
            } catch (error) {
                log('Set session data error: ' + error.message);
            }
        }

        async function createShortcut() {
            try {
                await gameSDK.createShortcut();
                log('Shortcut created successfully');
            } catch (error) {
                log('Create shortcut error: ' + error.message);
            }
        }

        function setupPauseListener() {
            try {
                gameSDK.onPause(() => {
                    log('Game paused - æ¸¸æˆå·²æš‚åœ');
                });
                log('Pause listener setup successfully');
            } catch (error) {
                log('Setup pause listener error: ' + error.message);
            }
        }

        function quitGame() {
            try {
                gameSDK.quitGame();
                log('Game quit requested');
            } catch (error) {
                log('Quit game error: ' + error.message);
            }
        }

        //è·å–è¯­è¨€
        async function getLocale() {
            try {
                const locale = await gameSDK.getLocale();
                log('Current Locale: ' + locale);
            } catch (error) {
                log('Get locale error: ' + error.message);
            }
        }

        // SDKä¿¡æ¯
        function showSDKInfo() {
            try {
                const info = {
                    platform: gameSDK.platformName,
                    config: gameSDK.config,
                    timestamp: new Date().toISOString()
                };
                log('SDK Info: ' + JSON.stringify(info, null, 2));
            } catch (error) {
                log('Show SDK info error: ' + error.message);
            }
        }
        function clearLog() {
            document.getElementById('output').textContent = '';
        }
    </script>
</body>

</html>
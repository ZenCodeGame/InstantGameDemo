!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).zkgameSdk={})}(this,function(e){"use strict";const t={PLATFORM:"auto",APP_ID:"10040",SECRET_KEY:"phc_Js87w93pRKVMN3AI4N1ITa8PaeNdeASpHg6fTaaWYzE",ENV:"production",AUTO_LOAD_FB_SDK:!1,DEBUG:!1,TEST_MODE:!1,FacebookPlayerId:"",FacebookAppSecret:""};var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var a=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};a.prototype=t.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(a,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}),a}var i={exports:{}};var r={exports:{}};const o=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var c;function d(){return c||(c=1,r.exports=(e=e||function(e,t){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==a&&a.crypto&&(s=a.crypto),!s)try{s=o}catch(k){}var n=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(k){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(k){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var a;return e.prototype=t,a=new e,e.prototype=null,a}}(),r={},c=r.lib={},d=c.Base=function(){return{extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),l=c.WordArray=d.extend({init:function(e,a){e=this.words=e||[],this.sigBytes=a!=t?a:4*e.length},toString:function(e){return(e||g).stringify(this)},concat:function(e){var t=this.words,a=e.words,s=this.sigBytes,n=e.sigBytes;if(this.clamp(),s%4)for(var i=0;i<n;i++){var r=a[i>>>2]>>>24-i%4*8&255;t[s+i>>>2]|=r<<24-(s+i)%4*8}else for(var o=0;o<n;o+=4)t[s+o>>>2]=a[o>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,a=this.sigBytes;t[a>>>2]&=4294967295<<32-a%4*8,t.length=e.ceil(a/4)},clone:function(){var e=d.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],a=0;a<e;a+=4)t.push(n());return new l.init(t,e)}}),u=r.enc={},g=u.Hex={stringify:function(e){for(var t=e.words,a=e.sigBytes,s=[],n=0;n<a;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push((i>>>4).toString(16)),s.push((15&i).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,a=[],s=0;s<t;s+=2)a[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new l.init(a,t/2)}},m=u.Latin1={stringify:function(e){for(var t=e.words,a=e.sigBytes,s=[],n=0;n<a;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var t=e.length,a=[],s=0;s<t;s++)a[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new l.init(a,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},p=c.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var a,s=this._data,n=s.words,i=s.sigBytes,r=this.blockSize,o=i/(4*r),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*r,d=e.min(4*c,i);if(c){for(var u=0;u<c;u+=r)this._doProcessBlock(n,u);a=n.splice(0,c),s.sigBytes-=d}return new l.init(a,d)},clone:function(){var e=d.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});c.Hasher=p.extend({cfg:d.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,a){return new e.init(a).finalize(t)}},_createHmacHelper:function(e){return function(t,a){return new y.HMAC.init(e,a).finalize(t)}}});var y=r.algo={};return r}(Math),e)),r.exports;var e}var l,u={exports:{}};function g(){return l||(l=1,u.exports=(e=d(),function(t){var a=e,s=a.lib,n=s.WordArray,i=s.Hasher,r=a.algo,o=[],c=[];!function(){function e(e){for(var a=t.sqrt(e),s=2;s<=a;s++)if(!(e%s))return!1;return!0}function a(e){return 4294967296*(e-(0|e))|0}for(var s=2,n=0;n<64;)e(s)&&(n<8&&(o[n]=a(t.pow(s,.5))),c[n]=a(t.pow(s,1/3)),n++),s++}();var d=[],l=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var a=this._hash.words,s=a[0],n=a[1],i=a[2],r=a[3],o=a[4],l=a[5],u=a[6],g=a[7],m=0;m<64;m++){if(m<16)d[m]=0|e[t+m];else{var h=d[m-15],p=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,y=d[m-2],k=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;d[m]=p+d[m-7]+k+d[m-16]}var f=s&n^s&i^n&i,w=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),b=g+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&l^~o&u)+c[m]+d[m];g=u,u=l,l=o,o=r+b|0,r=i,i=n,n=s,s=b+(w+f)|0}a[0]=a[0]+s|0,a[1]=a[1]+n|0,a[2]=a[2]+i|0,a[3]=a[3]+r|0,a[4]=a[4]+o|0,a[5]=a[5]+l|0,a[6]=a[6]+u|0,a[7]=a[7]+g|0},_doFinalize:function(){var e=this._data,a=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return a[n>>>5]|=128<<24-n%32,a[14+(n+64>>>9<<4)]=t.floor(s/4294967296),a[15+(n+64>>>9<<4)]=s,e.sigBytes=4*a.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});a.SHA256=i._createHelper(l),a.HmacSHA256=i._createHmacHelper(l)}(Math),e.SHA256)),u.exports;var e}var m,h,p,y,k,f={exports:{}};i.exports=function(e){return e.HmacSHA256}(d(),g(),m||(m=1,f.exports=(h=d(),y=(p=h).lib.Base,k=p.enc.Utf8,void(p.algo.HMAC=y.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=k.parse(t));var a=e.blockSize,s=4*a;t.sigBytes>s&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),r=n.words,o=i.words,c=0;c<a;c++)r[c]^=1549556828,o[c]^=909522486;n.sigBytes=i.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,a=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(a))}})))));const w=s(i.exports);var b={exports:{}};!function(e){e.exports=function(e){return function(){var t=e,a=t.lib.WordArray;function s(e,t,s){for(var n=[],i=0,r=0;r<t;r++)if(r%4){var o=s[e.charCodeAt(r-1)]<<r%4*2|s[e.charCodeAt(r)]>>>6-r%4*2;n[i>>>2]|=o<<24-i%4*8,i++}return a.create(n,i)}t.enc.Base64={stringify:function(e){var t=e.words,a=e.sigBytes,s=this._map;e.clamp();for(var n=[],i=0;i<a;i+=3)for(var r=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;o<4&&i+.75*o<a;o++)n.push(s.charAt(r>>>6*(3-o)&63));var c=s.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e){var t=e.length,a=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<a.length;i++)n[a.charCodeAt(i)]=i}var r=a.charAt(64);if(r){var o=e.indexOf(r);-1!==o&&(t=o)}return s(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(d())}(b);const D=s(b.exports);var A={exports:{}};!function(e){e.exports=function(e){return e.enc.Utf8}(d())}(A);const I=s(A.exports);function z(e){return D.stringify(I.parse(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function v(e,t){const a=z(JSON.stringify(e));return w(a,t).toString(D).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")+"."+a}function S(e,t){const a=Date.now(),s=`hw_${a}_${Math.random().toString(36).substring(2,8)}`,n=`华为玩家_${Math.random().toString(36).substring(2,6)}`,i=function(e,t,a){const s={algorithm:"HMAC-SHA256",appId:e,playerId:t,timestamp:Math.floor(Date.now()/1e3),nonce:Math.random().toString(36).substring(2,15),version:"1.0"},n=Object.keys(s).sort().map(e=>`${e}=${s[e]}`).join("&");return`${w(n,a).toString()}.${D.stringify(I.parse(JSON.stringify(s)))}`}(e,s,t);return{playerId:s,displayName:n,gameAuthSign:i,hiResImageUri:`https://example.com/avatar/${s}.jpg`,imageUri:`https://example.com/avatar/${s}_small.jpg`,playerLevel:"1",isAuth:1,ts:a.toString()}}function _(e,t,...a){e&&console.log(t,...a)}function P(e,...t){console.error(e,...t)}function T(e,...t){console.warn(e,...t)}async function L(e){const t=function(e){if("string"!=typeof e||!e)return"unknown";if(/^data:image\/(png|jpe?g|gif);base64,/i.test(e))return"base64";try{const t=new URL(e);if("http:"===t.protocol||"https:"===t.protocol)return"url"}catch{}return/^[A-Za-z0-9+/]+={0,2}$/.test(e)&&e.length>300?"base64-raw":"unknown"}(e);switch(t){case"base64":return e;case"base64-raw":return`data:image/png;base64,${e}`;case"url":try{return await async function(e){const t=await fetch(e,{mode:"cors"});if(!t.ok)throw new Error(`Failed to fetch image: ${t.status}`);const a=await t.blob();return new Promise((e,t)=>{const s=new FileReader;s.onloadend=()=>{"string"==typeof s.result?e(s.result):t(new Error("Failed to convert blob to base64"))},s.onerror=()=>t(s.error),s.readAsDataURL(a)})}(e)}catch(a){return T("Failed to convert image URL to base64:",a),e}default:return e}}class B{constructor(){this.initialized=!1,this.SD_EVENTS=["AddPaymentInfo","AddToCart","AddToWishlist","CompleteRegistration","Contact","CustomizeProduct","Donate","FindLocation","InitiateCheckout","Lead","Purchase","Schedule","Search","StartTrial","SubmitApplication","Subscribe","ViewContent"]}init(e){this.initialized||(e?(this.pixelId=e,this.injectScript().then(()=>{window.fbq("init",this.pixelId),window.fbq("track","PageView"),this.initialized=!0})):T("Meta Pixel ID is required for initialization."))}reportEvent(e,t,a){window.fbq&&(this.SD_EVENTS.includes(e)?window.fbq("track",e,a,{eventID:t}):window.fbq("trackCustom",e,a,{eventID:t}))}injectScript(){return new Promise((e,t)=>{const a=document.createElement("script");a.async=!0,a.src="https://connect.facebook.net/en_US/fbevents.js",a.onload=()=>e(),a.onerror=e=>t(e),document.head.appendChild(a),window.fbq=function(){window.fbq.callMethod?window.fbq.callMethod.apply(window.fbq,arguments):window.fbq.queue.push(arguments)},window.fbq.loaded=!0,window.fbq.queue=[]})}}class E{constructor(e){this.isDebug=!1,this.config=e,this.isDebug=!!e.DEBUG&&e.DEBUG,this.sessionId=Date.now()+"_"+Math.random().toString(36).slice(2,8),this.metaPixel=new B}init(e){var t=new Date,a=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`;_(this.isDebug,"Initializing Tracker with date default:",a),e&&this.metaPixel.init(e)}async sendEvent(e,t,a={}){const s={...a,sdk_app_id:this.config.APP_ID||"unknown",sdk_env:this.config.ENV||"production",session_id:this.sessionId};_(this.isDebug,"Sending event to Tracker:",e,s),this.metaPixel.reportEvent(e,t,s)}}const F={en:{"payment.not_ready":"CreateOrder failed: Payments not ready!","payment.network_error":"Network error!","payment.fail":"Pay fail","payment.canceled":"Pay cancelled","payment.network_fail":"Pay fail:Network error!","payment.success":"Pay success","payment.consume_fail":"Purchase consume fail","payment.check_fail":"Purchase check fail","payment.check_success":"Purchase check success"},"zh-CN":{"payment.not_ready":"创建订单失败：支付系统未就绪！","payment.network_error":"网络错误！","payment.fail":"支付失败","payment.canceled":"支付已取消","payment.network_fail":"支付失败：网络错误！","payment.success":"支付成功","payment.consume_fail":"购买消费失败","payment.check_fail":"购买验证失败","payment.check_success":"购买验证成功"},"zh-TW":{"payment.not_ready":"建立訂單失敗：支付系統未就緒！","payment.network_error":"網絡錯誤！","payment.fail":"支付失敗","payment.canceled":"支付已取消","payment.network_fail":"支付失敗：網絡錯誤！","payment.success":"支付成功","payment.consume_fail":"購買消費失敗","payment.check_fail":"購買驗證失敗","payment.check_success":"購買驗證成功"},id:{"payment.not_ready":"Buat pesanan gagal: Pembayaran belum siap!","payment.network_error":"Kesalahan jaringan!","payment.fail":"Pembayaran gagal","payment.canceled":"Pembayaran dibatalkan","payment.network_fail":"Pembayaran gagal: Kesalahan jaringan!","payment.success":"Pembayaran berhasil","payment.consume_fail":"Konsumsi pembelian gagal","payment.check_fail":"Verifikasi pembelian gagal","payment.check_success":"Verifikasi pembelian berhasil"},ms:{"payment.not_ready":"Buat pesanan gagal: Pembayaran belum sedia!","payment.network_error":"Ralat rangkaian!","payment.fail":"Pembayaran gagal","payment.canceled":"Pembayaran dibatalkan","payment.network_fail":"Pembayaran gagal: Ralat rangkaian!","payment.success":"Pembayaran berjaya","payment.consume_fail":"Konsumsi pembelian gagal","payment.check_fail":"Pengesahan pembelian gagal","payment.check_success":"Pengesahan pembelian berjaya"},th:{"payment.not_ready":"สร้างออเดอร์ล้มเหลว: ระบบชำระเงินยังไม่พร้อม!","payment.network_error":"ข้อผิดพลาดเครือข่าย!","payment.fail":"การชำระเงินล้มเหลว","payment.canceled":"การชำระเงินถูกยกเลิก","payment.network_fail":"การชำระเงินล้มเหลว: ข้อผิดพลาดเครือข่าย!","payment.success":"ชำระเงินสำเร็จ","payment.consume_fail":"การบริโภคการซื้อล้มเหลว","payment.check_fail":"การตรวจสอบการซื้อล้มเหลว","payment.check_success":"การตรวจสอบการซื้อสำเร็จ"},pt:{"payment.not_ready":"Falha ao criar pedido: Pagamentos não estão prontos!","payment.network_error":"Erro de rede!","payment.fail":"Pagamento falhou","payment.canceled":"Pagamento cancelado","payment.network_fail":"Pagamento falhou: Erro de rede!","payment.success":"Pagamento realizado com sucesso","payment.consume_fail":"Falha no consumo da compra","payment.check_fail":"Falha na verificação da compra","payment.check_success":"Verificação da compra bem-sucedida"},es:{"payment.not_ready":"¡Error al crear pedido: Pagos no están listos!","payment.network_error":"¡Error de red!","payment.fail":"Pago fallido","payment.canceled":"Pago cancelado","payment.network_fail":"Pago fallido: ¡Error de red!","payment.success":"Pago exitoso","payment.consume_fail":"Fallo en el consumo de la compra","payment.check_fail":"Fallo en la verificación de la compra","payment.check_success":"Verificación de la compra exitosa"}};class O{constructor(e){this.locale="en",this.setLocale(e||"en")}setLocale(e){const t=this.normalizeLocale(e);this.isSupportedLocale(t)?this.locale=t:this.locale="en"}getLocale(){return this.locale}t(e){return F[this.locale][e]||F.en[e]||e}normalizeLocale(e){const t=e.toLowerCase();return t.startsWith("zh")?t.includes("cn")||t.includes("hans")||"zh"===t?"zh-CN":t.includes("tw")||t.includes("hk")||t.includes("hant")?"zh-TW":"zh-CN":t.startsWith("en")?"en":t.startsWith("id")||"in"===t?"id":t.startsWith("ms")||"my"===t?"ms":t.startsWith("th")?"th":t.startsWith("pt")?"pt":t.startsWith("es")?"es":t}isSupportedLocale(e){return["en","zh-CN","zh-TW","id","ms","th","pt","es"].includes(e)}}class C{constructor(e){this.platformName="facebook",this.entryPointDataCache=null,this.paymentsIsReady=!1,this.isDebug=!1,this.config=e,this.isDebug=!!e.DEBUG&&e.DEBUG}async init(){console.log("[zkgame-sdk] FacebookPlatform init:",this.isDebug);const e=window.FBInstant;_(this.isDebug,"[zkgame-sdk] FacebookPlatform init called",(new Date).toISOString()),_(this.isDebug,"[zkgame-sdk] Initializing FBInstant...",e),_(this.isDebug,"[zkgame-sdk] FBInstant Player:",e.player.getID()),e.player.getID()||(await e.initializeAsync(),_(this.isDebug,"[zkgame-sdk] FBInstant initialized, loading game..."),e.setLoadingProgress(100),_(this.isDebug,"[zkgame-sdk] FBInstant loading complete"),await e.startGameAsync(),_(this.isDebug,"[zkgame-sdk] FBInstant game started"));var t=e.context.getID(),a=e.getLocale(),s=e.getPlatform(),n=e.getSDKVersion(),i=e.player.getID();_(this.isDebug,"[zkgame-sdk] FBInstant info:",{contextID:t,locale:a,platform:s,sdkVersion:n,playerID:i}),_(this.isDebug,"[zkgame-sdk] FBInstant initialized"),_(this.isDebug,"[zkgame-sdk] FBInstant payments:",JSON.stringify(e.payments)),e.payments.onReady(()=>{_(this.isDebug,"[zkgame-sdk] FBInstant payments is ready"),this.paymentsIsReady=!0})}async login(){_(this.isDebug,"[zkgame-sdk] FacebookPlatform login called",(new Date).toISOString());const e=window.FBInstant;return e&&e.player.getSignedPlayerInfoAsync?(_(this.isDebug,"[zkgame-sdk] FBInstant player:",e.player),await e.player.getSignedPlayerInfoAsync("zkgame_metadata")):(T(this.isDebug,"[zkgame-sdk] FBInstant.player.getSignedPlayerInfoAsync not available, mock login"),null)}async followOfficialPageAsync(){_(this.isDebug,"[zkgame-sdk] FacebookPlatform followOfficialPageAsync called")}async canFollowOfficialPageAsync(){return _(this.isDebug,"[zkgame-sdk] FacebookPlatform canFollowOfficialPageAsync called"),!1}async getLocale(){const e=window.FBInstant;if(!e||!e.getLocale)return T("[zkgame-sdk] FBInstant.getLocale not available, mock getLocale"),"en_US";try{const t=e.getLocale();return _(this.isDebug,"[zkgame-sdk] getLocale success",t),t}catch(t){return P("[zkgame-sdk] getLocale failed",JSON.stringify(t)),"en_US"}}async saveData(e){const t=window.FBInstant;if(t&&t.player.setDataAsync)try{await t.player.setDataAsync(e),await t.player.flushDataAsync(),_(this.isDebug,"[zkgame-sdk] saveData success",JSON.stringify(e))}catch(a){P("[zkgame-sdk] saveData failed",JSON.stringify(a))}else T("[zkgame-sdk] FBInstant.player.setDataAsync not available, mock saveData")}async loadData(e){const t=window.FBInstant;if(!t||!t.player.getDataAsync)return T("[zkgame-sdk] FBInstant.player.getDataAsync not available, mock loadData"),{};try{const a=await t.player.getDataAsync(e);return _(this.isDebug,"[zkgame-sdk] loadData success",JSON.stringify(a)),a}catch(a){return P("[zkgame-sdk] loadData failed",JSON.stringify(a)),{}}}async getConnectedPlayers(){const e=window.FBInstant;if(!e||!e.player.getConnectedPlayersAsync)return T("[zkgame-sdk] FBInstant.player.getConnectedPlayersAsync not available, mock getConnectedPlayers"),[];try{const t=await e.player.getConnectedPlayersAsync();return _(this.isDebug,"[zkgame-sdk] getConnectedPlayers success",JSON.stringify(t)),t.map(e=>({id:e.getID()}))}catch(t){return P("[zkgame-sdk] getConnectedPlayers failed",JSON.stringify(t)),[]}}async share(e){if(void 0===window.FBInstant)return void _(this.isDebug,"[zkgame-sdk] mock fb share",e);const t=window.FBInstant,a={};return e.image&&(a.image=e.image),e.title&&(a.text=e.title),a.data=e.data||{},e.intent?a.intent=e.intent:a.intent="SHARE",void 0!==e.switchContext&&(a.switchContext=!!e.switchContext),e.shareDestination&&(a.shareDestination=e.shareDestination),await t.shareAsync(a)}async inviteAsync(e){if(void 0===window.FBInstant)return void _(this.isDebug,"[zkgame-sdk] mock fb invite",e);const t=window.FBInstant,a={};return e.image&&(a.image=e.image),e.title&&(a.text=e.title),a.data=e.data||{},e.notificationText&&(a.notificationText=e.notificationText),e.cta&&(a.cta=e.cta),e.dialogTitle&&(a.dialogTitle=e.dialogTitle),e.filters&&(a.filters=e.filters),e.sections&&(a.sections=e.sections),await t.inviteAsync(a)}async chooseAsync(e){if(void 0===window.FBInstant)return void _(this.isDebug,"[zkgame-sdk] mock fb chooseAsync",e);const t=window.FBInstant,a={};return e&&(e.filters&&(a.filters=e.filters),e.maxSize&&(a.maxSize=e.maxSize),e.minSize&&(a.minSize=e.minSize)),await t.context.chooseAsync(a)}async updateAsync(e){const t=window.FBInstant;if(t&&t.updateAsync)try{await t.updateAsync(e),_(this.isDebug,"[zkgame-sdk] updateAsync success")}catch(a){P("[zkgame-sdk] updateAsync failed",JSON.stringify(a))}else T("[zkgame-sdk] FBInstant.updateAsync not available, mock updateAsync")}async showBannerAd(e,t){const a=window.FBInstant;if(!a||!a.loadBannerAdAsync)return T("[zkgame-sdk] FBInstant.loadBannerAdAsync not available, mock showBannerAd"),Promise.resolve();try{return await a.loadBannerAdAsync(e||"default_banner_placement",t||"bottom")}catch(s){P("[zkgame-sdk] loadBannerAdAsync failed",s)}return Promise.resolve()}async hideBannerAd(){const e=window.FBInstant;return e&&e.hideBannerAdAsync?await e.hideBannerAdAsync():(T("[zkgame-sdk] FBInstant.hideBannerAdAsync not available, mock hideBannerAd"),Promise.resolve())}async loadRewardedVideoAd(e){const t=window.FBInstant;if(!t||!t.getRewardedVideoAsync)return T("[zkgame-sdk] FBInstant.getRewardedVideoAsync not available, mock loadRewardedVideoAd"),null;try{_(this.isDebug,"[zkgame-sdk] Loading rewarded video ad with placementId:",e);const a=await t.getRewardedVideoAsync(e||"default_rewarded_placement");return await a.loadAsync(),_(this.isDebug,"[zkgame-sdk] Loaded rewarded video ad successfully",JSON.stringify(a)),a}catch(a){return P("[zkgame-sdk] loadRewardedVideoAd failed",JSON.stringify(a)),null}}async showRewardedVideoAd(e){if(!e)return T("[zkgame-sdk] showRewardedVideoAd called with null rewardedAd"),{success:!1,rewarded:!1,error:"广告对象为空",errorCode:"NULL_AD"};try{return await e.showAsync(),_(this.isDebug,"[zkgame-sdk] showRewardedVideoAd success"),{success:!0,rewarded:!0}}catch(t){P("[zkgame-sdk] showRewardedVideoAd failed",JSON.stringify(t));const e=t.code||t.type||"UNKNOWN_ERROR";let a="",s=!1;switch(e){case"ADS_NOT_LOADED":a="广告未加载完成，请先加载广告",s=!0;break;case"INVALID_PARAM":a="无效的广告参数",s=!1;break;case"NETWORK_FAILURE":a="网络连接失败，请检查网络",s=!0;break;case"INVALID_OPERATION":a="无效操作，广告可能已经显示过",s=!1;break;case"RATE_LIMITED":a="广告请求过于频繁，请稍后再试",s=!0;break;case"USER_INPUT":a="用户取消了广告观看",s=!1;break;default:a=`广告显示失败: ${t.message||"未知错误"}`,s=!0}return _(this.isDebug,`[zkgame-sdk] 错误详情: ${a}, 可重试: ${s}`),{success:!1,rewarded:!1,error:a,errorCode:e}}}async loadInterstitialAd(e){const t=window.FBInstant;if(!t||!t.getInterstitialAdAsync)return T("[zkgame-sdk] FBInstant.getInterstitialAdAsync not available, mock loadInterstitialAd"),null;try{const a=await t.getInterstitialAdAsync(e||"default_interstitial_placement");return await a.loadAsync(),a}catch(a){return P("[zkgame-sdk] loadInterstitialAd failed",JSON.stringify(a)),null}}async showInterstitialAd(e){if(!e)return T("[zkgame-sdk] showInterstitialAd called with null interstitialAd"),{success:!1};try{return await e.showAsync(),{success:!0}}catch(t){return P("[zkgame-sdk] showInterstitialAd failed",JSON.stringify(t)),{success:!1}}}isPaymentsReady(){return this.paymentsIsReady}async purchase(e,t){const a=window.FBInstant;if(!a||!a.payments)return T("[zkgame-sdk] FBInstant.payments not available, mock purchase"),{success:!0,productId:e,mock:!0};try{return{success:!0,purchase:await a.payments.purchaseAsync({productID:e,developerPayload:t?JSON.stringify(t):""})}}catch(s){return P("[zkgame-sdk] purchase failed",JSON.stringify(s)),{success:!1,error:s}}}async getPurchases(){const e=window.FBInstant;if(!e||!e.payments)return T("[zkgame-sdk] FBInstant.payments not available, mock getPurchases"),[];try{return await e.payments.getPurchasesAsync()}catch(t){return P("[zkgame-sdk] getPurchases failed",JSON.stringify(t)),[]}}async consumePurchase(e){const t=window.FBInstant;if(!t||!t.payments)return T("[zkgame-sdk] FBInstant.payments not available, mock consumePurchase"),{success:!0,purchaseToken:e,mock:!0};try{return await t.payments.consumePurchaseAsync(e),{success:!0}}catch(a){return P("[zkgame-sdk] consumePurchase failed",JSON.stringify(a)),{success:!1,error:a}}}async createShortcut(){const e=window.FBInstant;if(!e)return T("[zkgame-sdk] FBInstant not available, mock createShortcut"),{success:!1,message:"FBInstant not available"};try{return await e.canCreateShortcutAsync()?(await e.createShortcutAsync(),{success:!0}):{success:!1,message:"Shortcut already created or cannot create"}}catch(t){return P("[zkgame-sdk] createShortcut failed",JSON.stringify(t)),{success:!1,message:"createShortcut failed"}}}async switchGame(e,t){const a=window.FBInstant;if(!a)return T("[zkgame-sdk] FBInstant not available, mock switchGame"),{success:!1,message:"FBInstant not available"};try{return await a.switchGameAsync(e,t),{success:!0}}catch(s){return P("[zkgame-sdk] switchGame failed",JSON.stringify(s)),{success:!1,message:"switchGame failed"}}}async setLoadingProgress(e){const t=window.FBInstant;if(t)try{t.setLoadingProgress(e)}catch(a){P("[zkgame-sdk] setLoadingProgress failed",JSON.stringify(a))}else T("[zkgame-sdk] FBInstant not available, mock setLoadingProgress")}async getSupportedAPIs(){const e=window.FBInstant;if(!e)return T("[zkgame-sdk] FBInstant not available, mock getSupportedAPIs"),[];try{return e.getSupportedAPIs()}catch(t){return P("[zkgame-sdk] getSupportedAPIs failed",JSON.stringify(t)),[]}}async getEntryPointData(){const e=window.FBInstant;if(!e)return T("[zkgame-sdk] FBInstant not available, mock getEntryPointData"),null;try{const t=e.getEntryPointData();return _(this.isDebug,"[zkgame-sdk] getEntryPointData success",JSON.stringify(t)),t}catch(t){return P("[zkgame-sdk] getEntryPointData failed",JSON.stringify(t)),null}}async getMetaPixelID(){const e=await this.getCachedEntryPointData();return e&&e.pixel_id?e.pixel_id:""}async getChannel(){const e=await this.getCachedEntryPointData();return e&&e.channel?e.channel:""}async getInviteCode(){const e=await this.getCachedEntryPointData();return e&&e.invite_code?e.invite_code:""}async getCachedEntryPointData(){return null===this.entryPointDataCache&&(this.entryPointDataCache=await this.getEntryPointData()),this.entryPointDataCache}quitGame(){const e=window.FBInstant;if(e)try{e.quit()}catch(t){P("[zkgame-sdk] quitGame failed",JSON.stringify(t))}else T("[zkgame-sdk] FBInstant not available, mock quitGame")}onPause(e){const t=window.FBInstant;if(t)try{t.onPause(e)}catch(a){P("[zkgame-sdk] pauseGame failed",JSON.stringify(a))}else T("[zkgame-sdk] FBInstant not available, mock pauseGame")}async setSessionData(e){const t=window.FBInstant;if(t)try{t.setSessionData(e)}catch(a){P("[zkgame-sdk] setSessionData failed",JSON.stringify(a))}else T("[zkgame-sdk] FBInstant not available, mock setSessionData")}logEvent(e,t,a){const s=window.FBInstant;s?s.logEvent(e,t,a):T("[zkgame-sdk] FBInstant not available, mock logEvent")}async getLeaderboardScore(e){const t=window.FBInstant;if(!t||!t.globalLeaderboard)return T("[zkgame-sdk] FBInstant.globalLeaderboard not available, mock getLeaderboardScore"),0;try{const a=e+"."+t.context.getID(),s=await t.globalLeaderboard.getScoreAsync(a);return this.config.DEBUG&&_(this.isDebug,null!==s?`[zkgame-sdk] Your score: ${s}`:"[zkgame-sdk] You have not set a score yet"),s}catch(a){return P("[zkgame-sdk] getLeaderboardScore failed",JSON.stringify(a)),0}}async setLeaderboardScore(e,t){const a=window.FBInstant;if(!a||!a.globalLeaderboard)return T("[zkgame-sdk] FBInstant.globalLeaderboard not available, mock setLeaderboardScore"),{success:!1,message:"FBInstant.globalLeaderboard not available"};try{const s=e+"."+a.context.getID();return await a.globalLeaderboard.setScoreAsync(s,t),_(this.isDebug,"[zkgame-sdk] Score successfully updated"),{success:!0}}catch(s){return P("[zkgame-sdk] setLeaderboardScore failed",JSON.stringify(s)),{success:!1,message:s.message||"setLeaderboardScore failed"}}}async getTopLeaderboardEntries(e,t){const a=window.FBInstant;if(!a||!a.globalLeaderboard)return T("[zkgame-sdk] FBInstant.globalLeaderboard not available, mock getTopLeaderboardEntries"),[];try{const s=e+"."+a.context.getID(),n=await a.globalLeaderboard.getTopEntriesAsync(s,t);return _(this.isDebug,`[zkgame-sdk] Retrieved ${n.length} top entries`,n),n}catch(s){return P("[zkgame-sdk] getTopLeaderboardEntries failed",JSON.stringify(s)),[]}}async getTopFriendLeaderboardEntries(e,t){const a=window.FBInstant;if(!a||!a.globalLeaderboard)return T("[zkgame-sdk] FBInstant.globalLeaderboard not available, mock getTopFriendLeaderboardEntries"),[];try{const s=e+"."+a.context.getID(),n=await a.globalLeaderboard.getTopFriendEntriesAsync(s,t);return this.config.DEBUG&&_(this.isDebug,`[zkgame-sdk] Retrieved ${n.length} friend entries`,n),n}catch(s){return P("[zkgame-sdk] getTopFriendLeaderboardEntries failed",JSON.stringify(s)),[]}}}class N{constructor(e){this.platformName="web",this.config=e,this.isDebug=!!e.DEBUG&&e.DEBUG}async init(){console.log("[zkgame-sdk] WebPlatform init:",this.isDebug),_(this.isDebug,"[zkgame-sdk] WebPlatform init")}async getLocale(){_(this.isDebug,"[zkgame-sdk] mock getLocale");const e=navigator.language;return console.log(e),e}async getEntryPointData(){return _(this.isDebug,"[zkgame-sdk] mock getEntryPointData"),{}}async login(){var e=function(e,t="1249525301752201",a="zkgame_metadata"){const s={algorithm:"HMAC-SHA256",issued_at:Math.floor(Date.now()/1e3),player_id:t,request_payload:a},n=z(JSON.stringify(s)),i=w(n,e);return`${D.stringify(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}.${n}`}(this.config.FacebookAppSecret||"");const t={playerId:this.config.FacebookPlayerId||"",signature:e};return _(this.isDebug,"[zkgame-sdk] mock user:",t),t}async getConnectedPlayers(){return _(this.isDebug,"[zkgame-sdk] mock getConnectedPlayers"),[]}async share(e){_(this.isDebug,"[zkgame-sdk] mock share data:",e)}async inviteAsync(e){_(this.isDebug,"[zkgame-sdk] mock invite payload:",e)}async chooseAsync(e){_(this.isDebug,"[zkgame-sdk] mock chooseAsync options:",e)}async updateAsync(e){_(this.isDebug,"[zkgame-sdk] mock updateAsync payload:",e)}async purchase(e,t){_(this.isDebug,`[zkgame-sdk] mock purchase ${e}`,t),await new Promise(e=>setTimeout(e,300));const a={amount:"9.99",currency:"USD"},s=Math.floor(Date.now()/1e3),n={algorithm:"HMAC-SHA256",app_id:"1416622863801511",is_consumed:!1,issued_at:s,payment_action_type:"charge",payment_id:"7856234987654321",product_id:"fbigsku_9.99",purchase_price:a,purchase_time:s,purchase_token:"998877665544332211"};_(this.isDebug,"[zkgame-sdk] mock purchase signPayload:",n);const i=v(n,this.config.FacebookAppSecret||"ad5428ffc7a64f0f179e1b1603136adf"),r={developerPayload:JSON.stringify(t),isConsumed:!1,paymentActionType:"charge",paymentID:"7856234987654321",productID:"fbigsku_9.99",purchasePlatform:"FB",purchasePrice:a,purchaseTime:s,purchaseToken:"998877665544332211",signedRequest:i};return _(this.isDebug,"[zkgame-sdk] mock purchase:",r),{success:!0,purchase:r,mock:!0}}async consumePurchase(e){return _(this.isDebug,"[zkgame-sdk] mock consumePurchase",e),await new Promise(e=>setTimeout(e,300)),{success:!0,mock:!0}}async getPurchases(){return _(this.isDebug,"[zkgame-sdk] mock getPurchases"),await new Promise(e=>setTimeout(e,300)),[]}async createShortcut(){return _(this.isDebug,"[zkgame-sdk] mock createShortcut"),{success:!1,message:"CreateShortcut not available"}}async switchGame(e,t){return _(this.isDebug,`[zkgame-sdk] mock switchGame appID:${e} params:${t}`),{success:!1,message:"switchGame not available"}}async setSessionData(e){_(this.isDebug,"[zkgame-sdk] mock setSessionData")}onPause(e){_(this.isDebug,"[zkgame-sdk] mock onPause")}quitGame(){_(this.isDebug,"[zkgame-sdk] mock quitGame")}async getMetaPixelID(){return"2167889100404139"}async getChannel(){return"web_default"}async getInviteCode(){return"web10001"}isPaymentsReady(){return!0}logEvent(e,t,a){_(this.isDebug,`[zkgame-sdk] mock logEvent eventName:${e},vauleToSum:${t},parameters:${a}`)}showBannerAd(e,t){_(this.isDebug,`[zkgame-sdk] mock showBannerAd placementId:${e},position:${t}`)}hideBannerAd(){_(this.isDebug,"[zkgame-sdk] mock hideBannerAd")}async loadRewardedVideoAd(e){return _(this.isDebug,`[zkgame-sdk] mock loadRewardedVideoAd placementId:${e}`),null}async showRewardedVideoAd(e){return _(this.isDebug,`[zkgame-sdk] mock showRewardedVideoAd rewardedAd:${e}`),{success:!1,rewarded:!1}}async loadInterstitialAd(e){return _(this.isDebug,`[zkgame-sdk] mock loadInterstitialAd placementId:${e}`),null}async showInterstitialAd(e){return _(this.isDebug,`[zkgame-sdk] mock showInterstitialAd interstitialAd:${e}`),{success:!1}}async saveData(e){_(this.isDebug,"[zkgame-sdk] mock saveData data:",e)}async loadData(e){return _(this.isDebug,"[zkgame-sdk] mock loadData keys:",e),{}}async getLeaderboardScore(e){return _(this.isDebug,"[zkgame-sdk] mock getLeaderboardScore",e),0}async setLeaderboardScore(e,t){return _(this.isDebug,"[zkgame-sdk] mock setLeaderboardScore",e,t),{success:!0,message:"mock setLeaderboardScore success"}}async getTopLeaderboardEntries(e,t){return _(this.isDebug,"[zkgame-sdk] mock getTopLeaderboardEntries",e,t),[]}async getTopFriendLeaderboardEntries(e,t){return _(this.isDebug,"[zkgame-sdk] mock getTopFriendLeaderboardEntries",e,t),[]}}class R{constructor(e){this.platformName="huawei",this.gameType="unknown",this.isDebug=!1,this.config=e,this.isDebug=!!e.DEBUG&&e.DEBUG,this.detectGameType(),this.setupHuaweiCallbacks()}async init(){_(this.isDebug,"[zkgame-sdk] HuaweiPlatform init"),this.detectGameType(),this.setupHuaweiCallbacks()}detectGameType(){"undefined"!=typeof qg&&qg&&"function"==typeof qg.gameLoginWithReal?(this.gameType="runtime",_(this.isDebug,"[zkgame-sdk] Detected Huawei Runtime QuickGame environment")):"undefined"!=typeof window&&window.HwFastappObject?(this.gameType="h5",_(this.isDebug,"[zkgame-sdk] Detected Huawei H5 QuickGame environment")):(this.gameType="unknown",_(this.isDebug,"[zkgame-sdk] Huawei QuickGame environment not detected, using mock mode"))}setupHuaweiCallbacks(){"h5"===this.gameType&&"undefined"!=typeof window&&window.HwFastappObject&&(window.HwFastappObject.onGameLoginResult=e=>{_(this.isDebug,"[zkgame-sdk] Huawei H5 login result:",e),this.handleLoginResult(e)})}handleLoginResult(e){var t,a;if(0===e.code||"0"===e.code){let a;a=e.gameUserData?{playerId:e.gameUserData.playerId,displayName:e.gameUserData.displayName||"Huawei Player",playerLevel:e.gameUserData.playerLevel,ts:e.gameUserData.ts,isAuth:e.gameUserData.isAuth,hiResImageUri:e.gameUserData.hiResImageUri,imageUri:e.gameUserData.imageUri,gameAuthSign:e.gameUserData.gameAuthSign||"mock_signature"}:e.data?{playerId:e.data.playerId,displayName:e.data.displayName||"Huawei Player",playerLevel:e.data.playerLevel,ts:e.data.ts,isAuth:e.data.isAuth,hiResImageUri:e.data.hiResImageUri,imageUri:e.data.imageUri,gameAuthSign:e.data.gameAuthSign||"mock_signature"}:{playerId:e.playerId||"unknown_player",displayName:e.displayName||"Huawei Player",isAuth:e.isAuth||1,hiResImageUri:e.hiResImageUri,imageUri:e.imageUri,gameAuthSign:e.gameAuthSign||"mock_signature"},null==(t=this.loginResolve)||t.call(this,a)}else{let t=`Login failed, code: ${e.code}`;7004===e.code||2012===e.code?t="User cancelled login":7021===e.code&&(t="User cancelled identity verification"),null==(a=this.loginReject)||a.call(this,new Error(t))}}async login(){if(_(this.isDebug,`[zkgame-sdk] HuaweiPlatform login start - detected type: ${this.gameType}`),"unknown"===this.gameType){return S(this.config.HuaweiAppId||"mock_huawei_app_id",this.config.HuaweiSecretKey||"mock_secret_key")}return new Promise((e,t)=>{var a;this.loginResolve=e,this.loginReject=t;const s=this.config.HuaweiAppId||"test_app_id";if("runtime"===this.gameType)qg&&qg.gameLogin?qg.gameLogin({forceLogin:1,appid:s,success:e=>{_(this.isDebug,"[zkgame-sdk] Huawei Runtime login success:",e),this.handleLoginResult({code:0,data:e})},fail:(e,t)=>{_(this.isDebug,"[zkgame-sdk] Huawei Runtime login failed:",e,t),this.handleLoginResult({code:t,message:e})}}):t(new Error("qg.gameLoginWithReal method not available"));else if("h5"===this.gameType){const e={appid:s,forceLogin:1};(null==(a=window.HwFastappObject)?void 0:a.gameLogin)?window.HwFastappObject.gameLogin(JSON.stringify(e)):t(new Error("HwFastappObject login method not available"))}})}async getConnectedPlayers(){return _(this.isDebug,"[zkgame-sdk] mock getConnectedPlayers"),[]}async getLocale(){_(this.isDebug,"[zkgame-sdk] mock getLocale");const e=navigator.language;return console.log(e),e}async getEntryPointData(){return _(this.isDebug,"[zkgame-sdk] mock getEntryPointData"),{}}async share(e){_(this.isDebug,"[zkgame-sdk] mock share data:",e)}async inviteAsync(e){_(this.isDebug,"[zkgame-sdk] mock invite payload:",e)}async chooseAsync(e){_(this.isDebug,"[zkgame-sdk] mock chooseAsync options:",e)}async updateAsync(e){_(this.isDebug,"[zkgame-sdk] mock updateAsync payload:",e)}async purchase(e,t){_(this.isDebug,`[zkgame-sdk] mock purchase ${e}`,t),await new Promise(e=>setTimeout(e,300));const a={amount:"9.99",currency:"USD"},s=Math.floor(Date.now()/1e3),n={algorithm:"HMAC-SHA256",app_id:this.config.HuaweiAppId,is_consumed:!1,issued_at:s,payment_action_type:"charge",payment_id:"mock_payment_"+Date.now(),product_id:e,purchase_price:a,purchase_time:s,purchase_token:"mock_token_"+Date.now()},i=v(n,this.config.SECRET_KEY||"mock_secret");return{success:!0,purchase:{developerPayload:JSON.stringify(t),isConsumed:!1,paymentActionType:"charge",paymentID:n.payment_id,productID:e,purchasePlatform:"HUAWEI",purchasePrice:a,purchaseTime:s,purchaseToken:n.purchase_token,signedRequest:i},mock:!0}}async consumePurchase(e){return _(this.isDebug,"[zkgame-sdk] mock consumePurchase",e),await new Promise(e=>setTimeout(e,300)),{success:!0,mock:!0}}async getPurchases(){return _(this.isDebug,"[zkgame-sdk] mock getPurchases"),[]}async createShortcut(){return _(this.isDebug,"[zkgame-sdk] mock createShortcut"),{success:!1,message:"CreateShortcut not available"}}async switchGame(e,t){return _(this.isDebug,`[zkgame-sdk] mock switchGame appID:${e}`),{success:!1,message:"switchGame not available"}}async setSessionData(e){_(this.isDebug,"[zkgame-sdk] mock setSessionData")}onPause(e){_(this.isDebug,"[zkgame-sdk] mock onPause")}quitGame(){_(this.isDebug,"[zkgame-sdk] mock quitGame")}async getMetaPixelID(){return"mock_pixel_id"}async getChannel(){return"huawei_global"}async getInviteCode(){return"hw10001"}isPaymentsReady(){return!0}logEvent(e,t,a){_(this.isDebug,`[zkgame-sdk] mock logEvent ${e}`,{valueToSum:t,parameters:a})}showBannerAd(e,t){_(this.isDebug,`[zkgame-sdk] mock showBannerAd ${e} ${t}`)}hideBannerAd(){_(this.isDebug,"[zkgame-sdk] mock hideBannerAd")}async loadRewardedVideoAd(e){return _(this.isDebug,`[zkgame-sdk] mock loadRewardedVideoAd ${e}`),null}async showRewardedVideoAd(e){return _(this.isDebug,"[zkgame-sdk] mock showRewardedVideoAd"),{success:!1,rewarded:!1}}async loadInterstitialAd(e){return _(this.isDebug,`[zkgame-sdk] mock loadInterstitialAd ${e}`),null}async showInterstitialAd(e){return _(this.isDebug,"[zkgame-sdk] mock showInterstitialAd"),{success:!1}}async saveData(e){_(this.isDebug,"[zkgame-sdk] mock saveData",e)}async loadData(e){return _(this.isDebug,"[zkgame-sdk] mock loadData",e),{}}async getLeaderboardScore(e){return _(this.isDebug,`[zkgame-sdk] mock getLeaderboardScore ${e}`),0}async setLeaderboardScore(e,t){return _(this.isDebug,`[zkgame-sdk] mock setLeaderboardScore ${e} ${t}`),{success:!0,message:"mock success"}}async getTopLeaderboardEntries(e,t){return _(this.isDebug,`[zkgame-sdk] mock getTopLeaderboardEntries ${e} ${t}`),[]}async getTopFriendLeaderboardEntries(e,t){return _(this.isDebug,`[zkgame-sdk] mock getTopFriendLeaderboardEntries ${e} ${t}`),[]}}class U{constructor(e){this.platformName="telegram",this.webApp=null,this.scriptLoaded=!1,this.isDebug=!1,this.config=e,this.isDebug=!!e.DEBUG&&e.DEBUG,_(this.isDebug,"[zkgame-sdk] TelegramPlatform constructor called",(new Date).toISOString())}loadTelegramScript(){return new Promise((e,t)=>{var a;if("undefined"!=typeof window&&(null==(a=window.Telegram)?void 0:a.WebApp))return this.scriptLoaded=!0,void e();const s=document.querySelector('script[src*="telegram-web-app.js"]');if(s)return s.addEventListener("load",()=>{this.scriptLoaded=!0,e()}),void s.addEventListener("error",t);const n=document.createElement("script");n.src="https://telegram.org/js/telegram-web-app.js?59",n.async=!0,n.onload=()=>{_(this.isDebug,"[zkgame-sdk] Telegram Web App SDK loaded successfully"),this.scriptLoaded=!0,e()},n.onerror=e=>{P("[zkgame-sdk] Failed to load Telegram Web App SDK",e),t(new Error("Failed to load Telegram Web App SDK"))},document.head.appendChild(n)})}async init(){var e;_(this.isDebug,"[zkgame-sdk] TelegramPlatform init called",(new Date).toISOString());try{await this.loadTelegramScript()}catch(t){return void P("[zkgame-sdk] Failed to initialize Telegram SDK",t)}"undefined"!=typeof window&&(null==(e=window.Telegram)?void 0:e.WebApp)?(this.webApp=window.Telegram.WebApp,this.webApp.ready(),this.webApp.expand(),_(this.isDebug,"[zkgame-sdk] Telegram WebApp info:",{version:this.webApp.version,platform:this.webApp.platform,initData:this.webApp.initData,user:this.webApp.initDataUnsafe.user,colorScheme:this.webApp.colorScheme,viewportHeight:this.webApp.viewportHeight}),_(this.isDebug,"[zkgame-sdk] Telegram WebApp initialized")):T("[zkgame-sdk] Telegram WebApp not available")}async login(){if(_(this.isDebug,"[zkgame-sdk] TelegramPlatform login called",(new Date).toISOString()),!this.webApp||!this.webApp.initDataUnsafe.user)return T("[zkgame-sdk] Telegram WebApp user not available, mock login"),null;const e=this.webApp.initDataUnsafe.user,t=e.username||`${e.first_name}${e.last_name?" "+e.last_name:""}`;return{playerId:e.id.toString(),signature:this.webApp.initData,name:t,avatar:e.photo_url||""}}async saveData(e){if(this.webApp&&this.webApp.CloudStorage)try{const t=Object.entries(e).map(([e,t])=>new Promise((a,s)=>{this.webApp.CloudStorage.setItem(e,JSON.stringify(t),(e,t)=>{e?s(e):a()})}));await Promise.all(t),this.config.DEBUG&&_(this.isDebug,"[zkgame-sdk] saveData success",e)}catch(t){P("[zkgame-sdk] saveData failed",t)}else{T("[zkgame-sdk] Telegram CloudStorage not available, using localStorage");for(const[t,a]of Object.entries(e))localStorage.setItem(`telegram_${t}`,JSON.stringify(a))}}async loadData(e){if(!this.webApp||!this.webApp.CloudStorage){T("[zkgame-sdk] Telegram CloudStorage not available, using localStorage");const a={};for(const s of e){const e=localStorage.getItem(`telegram_${s}`);if(e)try{a[s]=JSON.parse(e)}catch(t){a[s]=e}}return a}try{return new Promise((a,s)=>{this.webApp.CloudStorage.getItems(e,(e,n)=>{if(e)s(e);else{const e={};if(n)for(const[a,s]of Object.entries(n))try{e[a]=JSON.parse(s)}catch(t){e[a]=s}this.config.DEBUG&&_(this.isDebug,"[zkgame-sdk] loadData success",e),a(e)}})})}catch(t){return P("[zkgame-sdk] loadData failed",t),{}}}async getConnectedPlayers(){return _(this.isDebug,"[zkgame-sdk] mock getConnectedPlayers"),[]}async getLocale(){_(this.isDebug,"[zkgame-sdk] mock getLocale");const e=navigator.language;return console.log(e),e}async getEntryPointData(){return _(this.isDebug,"[zkgame-sdk] mock getEntryPointData"),{}}async share(e){if(this.webApp)try{const t=e.title||"Check out this game!",a=e.data?btoa(JSON.stringify(e.data)):"";this.webApp.switchInlineQuery(a?`${t} - ${a}`:t,["users","groups","channels"])}catch(t){P("[zkgame-sdk] share failed",t)}else _(this.isDebug,"[zkgame-sdk] mock telegram share",e)}async inviteAsync(e){_(this.isDebug,"[zkgame-sdk] mock invite payload:",e)}async chooseAsync(e){_(this.isDebug,"[zkgame-sdk] mock chooseAsync options:",e)}async updateAsync(e){_(this.isDebug,"[zkgame-sdk] mock updateAsync payload:",e)}async showBannerAd(e,t){_(this.isDebug,`[zkgame-sdk] Telegram does not support banner ads. placementId: ${e}, position: ${t}`)}async hideBannerAd(){_(this.isDebug,"[zkgame-sdk] Telegram does not support banner ads")}async loadRewardedVideoAd(e){return _(this.isDebug,`[zkgame-sdk] Telegram does not support rewarded video ads. placementId: ${e}`),null}async showRewardedVideoAd(e){return _(this.isDebug,"[zkgame-sdk] Telegram does not support rewarded video ads"),{success:!1,rewarded:!1}}async loadInterstitialAd(e){return _(this.isDebug,`[zkgame-sdk] Telegram does not support interstitial ads. placementId: ${e}`),null}async showInterstitialAd(e){return _(this.isDebug,"[zkgame-sdk] Telegram does not support interstitial ads"),{success:!1}}isPaymentsReady(){return null!==this.webApp}async purchase(e,t){if(!this.webApp)return T("[zkgame-sdk] Telegram WebApp not available, mock purchase"),{success:!1,error:"Telegram WebApp not available"};try{return _(this.isDebug,"[zkgame-sdk] Telegram purchase initiated",{productId:e,payload:t}),new Promise(e=>{this.webApp.showAlert("Payment feature requires backend integration with Telegram Bot API",()=>{e({success:!1,message:"Payment not implemented"})})})}catch(a){return P("[zkgame-sdk] purchase failed",a),{success:!1,error:a}}}async getPurchases(){return _(this.isDebug,"[zkgame-sdk] Telegram getPurchases - requires backend integration"),[]}async consumePurchase(e){return _(this.isDebug,"[zkgame-sdk] Telegram consumePurchase - requires backend integration",e),{success:!0,mock:!0}}async createShortcut(){if(!this.webApp)return T("[zkgame-sdk] Telegram WebApp not available"),{success:!1,message:"Telegram WebApp not available"};try{return this.webApp.showAlert("Add this game to your home screen for quick access!",()=>{_(this.isDebug,"[zkgame-sdk] Shortcut prompt shown")}),{success:!0}}catch(e){return P("[zkgame-sdk] createShortcut failed",e),{success:!1,message:"createShortcut failed"}}}async switchGame(e,t){if(!this.webApp)return T("[zkgame-sdk] Telegram WebApp not available"),{success:!1,message:"Telegram WebApp not available"};try{const a=`https://t.me/${e}${t?"?startapp="+btoa(JSON.stringify(t)):""}`;return this.webApp.openTelegramLink(a),{success:!0}}catch(a){return P("[zkgame-sdk] switchGame failed",a),{success:!1,message:"switchGame failed"}}}async setSessionData(e){_(this.isDebug,"[zkgame-sdk] setSessionData",e),await this.saveData({_session:e})}onPause(e){if(!this.webApp)return void T("[zkgame-sdk] Telegram WebApp not available");this.webApp.onEvent("viewportChanged",()=>{this.webApp.isExpanded||e()})}quitGame(){if(this.webApp)try{this.webApp.close()}catch(e){P("[zkgame-sdk] quitGame failed",e)}else T("[zkgame-sdk] Telegram WebApp not available")}async getMetaPixelID(){var e;const t=null==(e=this.webApp)?void 0:e.initDataUnsafe.start_param;if(t)try{const e=JSON.parse(atob(t));if(e.pixel_id)return e.pixel_id}catch(a){}return""}async getChannel(){var e;const t=null==(e=this.webApp)?void 0:e.initDataUnsafe.start_param;if(t)try{const e=JSON.parse(atob(t));if(e.channel)return e.channel}catch(a){}return"telegram_default"}async getInviteCode(){var e;const t=null==(e=this.webApp)?void 0:e.initDataUnsafe.start_param;if(t)try{const e=JSON.parse(atob(t));if(e.invite_code)return e.invite_code}catch(a){}return t||""}logEvent(e,t,a){var s;_(this.isDebug,`[zkgame-sdk] logEvent eventName: ${e}, valueToSum: ${t}, parameters:`,a),(null==(s=this.webApp)?void 0:s.HapticFeedback)&&(e.toLowerCase().includes("success")||e.toLowerCase().includes("complete"))&&this.webApp.HapticFeedback.notificationOccurred("success")}async getLeaderboardScore(e){return _(this.isDebug,"[zkgame-sdk] Telegram getLeaderboardScore",e),0}async setLeaderboardScore(e,t){return _(this.isDebug,"[zkgame-sdk] Telegram setLeaderboardScore",e,t),{success:!0,message:"Telegram leaderboard requires backend implementation"}}async getTopLeaderboardEntries(e,t){return _(this.isDebug,"[zkgame-sdk] Telegram getTopLeaderboardEntries",e,t),[]}async getTopFriendLeaderboardEntries(e,t){return _(this.isDebug,"[zkgame-sdk] Telegram getTopFriendLeaderboardEntries",e,t),[]}}class ${constructor(e){this.HOST_URL="https://api.zencodegame.com",this.HOST_TEST_URL="https://testapi.zencodegame.com",this.isDebug=!1,this.userId="",this.config=e?{...t,...e}:t,this.isDebug=!!this.config.DEBUG&&this.config.DEBUG,this.tracker=new E(this.config),this.i18n=new O;const a="auto"===this.config.PLATFORM?void 0!==window.FBInstant?"facebook":void 0!==window.HwFastappObject?"huawei":"web":this.config.PLATFORM;this.platformImpl="facebook"===a?new C(this.config):"huawei"===a?new R(this.config):"telegram"===a?new U(this.config):new N(this.config),this.platformName=a}getPlatform(){return this.platformImpl}async init(){await this.platformImpl.init();const e=await this.platformImpl.getLocale();this.i18n.setLocale(e);var t=await this.platformImpl.getMetaPixelID();this.tracker.init(t)}async getLocale(){const e=await this.platformImpl.getLocale();return _(this.isDebug,`[zkgame-sdk] getLocale: ${e}`),e}setLocale(e){this.i18n.setLocale(e),_(this.isDebug,`[zkgame-sdk] setLocale: ${e} -> ${this.i18n.getLocale()}`)}getCurrentLocale(){return this.i18n.getLocale()}async getEntryPointData(){const e=await this.platformImpl.getEntryPointData();return _(this.isDebug,"[zkgame-sdk] getEntryPointData: ",e),e}async login(){_(this.isDebug,`[zkgame-sdk] Login platformName:${this.platformName}`);const e=await this.platformImpl.login();if(_(this.isDebug,"[zkgame-sdk] Login platform userInfo:",e),!e)return P("[zkgame-sdk] Login request failed user is null"),null;var t=await this.platformImpl.getChannel(),a=await this.platformImpl.getInviteCode(),s=null;try{switch(this.platformName){case"facebook":var n={id:e.getPlayerID(),signature:e.getSignature()};s=await this.zkgameLogin("fb_instant_game",t,a,JSON.stringify(n),e.getPlayerID());break;case"huawei":var i={playerId:e.playerId,playerLevel:e.playerLevel,ts:e.ts,playerSSign:e.gameAuthSign,isAuth:e.isAuth?e.isAuth:1};s=await this.zkgameLogin("huawei_fast_game",t,a,JSON.stringify(i),e.playerId);break;case"web":var r={id:e.playerId,signature:e.signature};s=await this.zkgameLogin("fb_instant_game",t,a,JSON.stringify(r),e.playerId)}if(s){this.userId=s.userId;try{this.trackEvent("Lead",s.userId,"1",{userId:s.userId,channel:t,invite_code:a})}catch(o){}this.fetchUnconsumedPurchases()}return s}catch(c){return P("[zkgame-sdk] Login request failed",c),null}}async getConnectedPlayers(){return await this.platformImpl.getConnectedPlayers()}async saveData(e){await this.platformImpl.saveData(e)}async loadData(e){return await this.platformImpl.loadData(e)}async toPay(e){e.country||(e.country="US"),e.currency||(e.currency="USD");var t=this.userId;this.trackEvent("Topay",e.orderId,e.amount,{currency:e.currency,value:e.amount,userId:t});const a=this.config.TEST_MODE?this.HOST_TEST_URL+"/pay/createPaymentOrder":this.HOST_URL+"/pay/createPaymentOrder";var s={appId:this.config.APP_ID,userId:t,country:e.country,merTransNo:e.orderId,amount:e.amount,currency:e.currency,prodName:e.prodName,description:e.description,merCustomize:e.extra,notifyUrl:e.callbackUrl,platform:this.platformName};try{if(_(this.isDebug,"[zkgame-sdk] CreateOrder request requestParams:",s),!this.platformImpl.isPaymentsReady())return{success:!1,message:this.i18n.t("payment.not_ready")};const u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)});if(!u.ok)return{success:!1,message:this.i18n.t("payment.network_error")};const g=await u.json();if(_(this.isDebug,"[zkgame-sdk] CreateOrder request result",g),200!==g.code)return{success:!1,message:this.i18n.t("payment.network_error")};const m=g.data;_(this.isDebug,"[zkgame-sdk] CreateOrder request orderData:",m);var n=m.merTransNo,i=(m.currency,m.amount,m.skuId),r=m.tradeNo,o=m.url;this.trackEvent("CreateOrder",n,e.amount,{currency:e.currency,value:e.amount,content_ids:[i],userId:t});var c={tradeNo:r,url:o},d=await this.platformImpl.purchase(i,c);if(_(this.isDebug,"[zkgame-sdk] purchase request:",d),d&&d.success)return await this.checkAndConsumePurchase(d.purchase);if(d&&d.error){var l=d.error.code;d.error.message;if("USER_INPUT"===l)return{success:!1,message:this.i18n.t("payment.canceled")}}return{success:!1,message:this.i18n.t("payment.fail")}}catch(u){return P("[zkgame-sdk] CreateOrder request failed",u),{success:!1,message:this.i18n.t("payment.network_fail")}}}async showBannerAd(e,t){this.platformImpl.showBannerAd(e,t)}async hideBannerAd(){await this.platformImpl.hideBannerAd()}async loadRewardedVideoAd(e){return await this.platformImpl.loadRewardedVideoAd(e)}async showRewardedVideoAd(e){return await this.platformImpl.showRewardedVideoAd(e)}async loadShowRewardedVideoAd(e){const t=await this.platformImpl.loadRewardedVideoAd(e);return await this.platformImpl.showRewardedVideoAd(t)}async loadInterstitialAd(e){return await this.platformImpl.loadInterstitialAd(e)}async showInterstitialAd(e){return await this.platformImpl.showInterstitialAd(e)}async loadShowInterstitialAd(e){const t=await this.platformImpl.loadInterstitialAd(e);return await this.platformImpl.showInterstitialAd(t)}trackEvent(e,t,a,s={}){this.tracker.sendEvent(e,t,s),this.platformImpl.logEvent(e,this.toNumber(a),s)}async share(e){e.image=await L(e.image||"");try{this.trackEvent("Share","1","1",{data:e.data})}catch(t){}return await this.platformImpl.share(e)}async inviteAsync(e){e.image=await L(e.image||"");try{this.trackEvent("InviteAsync","1","1",{data:e.data})}catch(t){}return await this.platformImpl.inviteAsync(e)}async chooseAsync(e){try{this.trackEvent("ChooseAsync","1","1",{options:e})}catch(t){}return await this.platformImpl.chooseAsync(e)}async updateAsync(e){try{this.trackEvent("UpdateAsync","1","1",{action:e.action,data:e.data})}catch(t){}return await this.platformImpl.updateAsync(e)}async createShortcut(){const e=await this.platformImpl.createShortcut();try{this.trackEvent("CreateShortcut","1","1",{success:e.success})}catch(t){}return e}async switchGame(e,t){return await this.platformImpl.switchGame(e,t)}async setSessionData(e){await this.platformImpl.setSessionData(e)}onPause(e){this.platformImpl.onPause(e)}quitGame(){this.platformImpl.quitGame()}async getLeaderboardScore(e){return await this.platformImpl.getLeaderboardScore(e)}async setLeaderboardScore(e,t){return await this.platformImpl.setLeaderboardScore(e,t)}async getTopLeaderboardEntries(e,t){return await this.platformImpl.getTopLeaderboardEntries(e,t)}async getTopFriendLeaderboardEntries(e,t){return await this.platformImpl.getTopFriendLeaderboardEntries(e,t)}async zkgameGetUserWithToken(e,t){const a=this.config.TEST_MODE?this.HOST_TEST_URL+"/api/v1/client/user":this.HOST_URL+"/api/v1/client/user";try{const s=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();if(200!==n.code)throw new Error(`Login failed: ${n.message}`);const i=n.data,r=i.token;return r&&(localStorage.setItem("zkgame_user_token_"+e,r),localStorage.setItem("zkgame_user_id",i.uid.toString())),{userId:i.uid.toString(),name:i.name,avatar:i.avatar}}catch(s){throw P("[zkgame-sdk] Login request failed",s),s}}async zkgameLogin(e,t,a,s,n){const i="zkgame_user_token_"+this.config.APP_ID+"_"+n;var r=localStorage.getItem(i);if(r)try{return await this.zkgameGetUserWithToken(n,r)}catch(d){P("[zkgame-sdk] zkgameGetUserWithToken request failed",d)}const o=this.config.TEST_MODE?this.HOST_TEST_URL+"/api/v1/client/third-party/login":this.HOST_URL+"/api/v1/client/third-party/login",c={platform:e,app_id:this.config.APP_ID,channel:t,invite_code:a,code:s};try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(200!==t.code)throw new Error(`Login failed: ${t.message}`);const a=t.data;if(r=a.token)return localStorage.setItem(i,r),localStorage.setItem("zkgame_user_id",a.uid.toString()),{userId:a.uid.toString(),name:a.name,avatar:a.avatar,token:r};throw new Error("Login failed: token is missing in response")}catch(d){throw P("[zkgame-sdk] Login request failed",d),d}}async fetchUnconsumedPurchases(){try{const t=await this.platformImpl.getPurchases();for(const a of t)try{_(this.isDebug,"[zkgame-sdk] checkAndConsumePurchase purchase:",a);const e=await this.checkAndConsumePurchase(a);_(this.isDebug,"[zkgame-sdk] checkAndConsumePurchase result:",e)}catch(e){P("[zkgame-sdk] Failed to consume purchase:",a,e)}}catch(e){P("[zkgame-sdk] Failed to fetch unconsumed purchases:",e)}}async checkAndConsumePurchase(e){_(this.isDebug,"[zkgame-sdk] checkAndConsumePurchase purchaseInfo:",e);var t=JSON.parse(e.developerPayload).url;await this.platformImpl.getChannel(),this.trackEvent("Purchase",e.paymentID,e.purchasePrice.amount,{currency:e.purchasePrice.currency,value:e.purchasePrice.amount,content_ids:[e.productID],userId:this.userId});return(await this.checkPurchase(JSON.stringify(e),t)).success?(await this.platformImpl.consumePurchase(e.purchaseToken)).success?{success:!0,message:this.i18n.t("payment.success")}:{success:!1,message:this.i18n.t("payment.consume_fail")}:{success:!1,message:this.i18n.t("payment.check_fail")}}async checkPurchase(e,t){try{const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:e});if(!a.ok)throw new Error(`[zkgame-sdk] HTTP error! status: ${a.status}`);const s=await a.json();if(s&&"SUCCESS"==s.code)return{success:!0,message:this.i18n.t("payment.check_success")}}catch(a){P("[zkgame-sdk] checkPurchase request failed",a)}return{success:!1,message:this.i18n.t("payment.check_fail")}}toNumber(e){if(!e)return;const t=Number(e);return isNaN(t)?void 0:t}}const x=new $;"undefined"!=typeof window&&(window.zkgameSDK=x,window.GameSDK=$,window.I18nManager=O,window.zkgameSDKInit=e=>{console.warn("zkgameSDKInit called — page should import module and pass config to constructor if needed")}),e.GameSDK=$,e.I18nManager=O,e.default=x,e.gameSDK=x,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
